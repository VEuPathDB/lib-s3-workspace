= S3 Workspaces

image:https://img.shields.io/badge/jvm-16-blue[title="Compatible with JVM 16"]

A thin wrapper library around https://github.com/VEuPathDB/lib-s34k[S34K] treating an S3 object store as a remote
filesystem.

== Workspaces

Workspaces are directories keyed on a https://github.com/VEuPathDB/lib-hash-id[HashID] which contain files and
sub-workspaces relevant to a specific job.

NOTE: As S3 stores have no concept of directories, workspaces are marked with a special file named `.workspace`.
This file is kept at the root of a workspace.  This library uses the workspace marker file to simulate directory and
file operations.

== Development

=== Design

image::docs/assets/simple-flow.png[align="center"]

This library stands between a "workspace" based application (such as
https://github.com/VEuPathDB/service-multi-blast[MultiBlast]) and an https://github.com/VEuPathDB/lib-s34k[S34K] wrapped
S3 Object store instance.

This library wraps S34K and provides filesystem like operations and utilities that are backed by requests to the S3
server.

.**Example**
[source, kotlin]
----
val factory = WorkspaceFactory(s3, "bucket-name")

val workspace = factory.create(HashID.ofMD5("my workspace id"))

val inputStream = workspace.open("my-file-name.txt")
----

=== End-to-End Testing

This repo contains an end-to-end test suite consisting of a standalone application with a docker-compose stack that runs
that application against a blank MinIO instance.

This application consumes the `lib-s3-workspace` library as a standard gradle dependency and operates as an 'unrelated'
service.

==== Execution

===== Reporting

==== Development